      PROGRAM    DIST                                                       XSSS
 
C* REVISED 11-MAR-93.
C* PRODUCES A DISTANCE MATRIX.
 
      CHARACTER PIDP*230
      PARAMETER (PIDP = '|DIST version 2.05 Win32-gfortran||'//
     *'M.J. Dallwitz and T.A. Paine||'//
     *'CSIRO Division of Entomology, '//
     *'GPO Box 1700, Canberra, ACT 2601, Australia|'//
     *'Phone +61 2 6246 4075. '//
     *'Fax +61 2 6246 4000. Internet delta@ento.csiro.au||%')

      PARAMETER (LWP = 60000, NPARAM = 18)                                    =*
 
      COMMON W(LWP)
      DIMENSION IW(LWP),IPARAM(NPARAM)
      EQUIVALENCE (W,IW)
 
      COMMON /PIDXXX/ PID
        CHARACTER*230 PID
 
      LW = LWP
      PID = PIDP
      NPAR = NPARAM
      CALL DIST1 (W, IW, LW, IPARAM, NPAR)
 
      END
      SUBROUTINE EXNAME (FSPEC, FNAME)                                      XSSS

C* REVISED 19/8/87.
C* EXTRACTS FILE NAME AND TYPE FROM FILE SPECIFICATION.

C  ALSO, IF THE SPECIFICATION DOES NOT CONTAIN A FILE TYPE, AND THE
C    DEFAULT FILE TYPE (AS INSERTED BY THE COMPILER) IS NOT NULL, A NULL
C    TYPE (I.E. A DOT) IS EXPLICITLY INSERTED IN THE SPECIFICATION.

C  FSPEC RECEIVES AND RETURNS A FILE SPECIFICATION.
C    IN THIS VERSION, THE RETURNED FILE SPECIFICATION IS UNALTERED.
C  FNAME RETURNS THE FILE NAME AND TYPE (EXTENSION), I.E. THE FILE
C    SPECIFICATION LESS ANY DISC NAME AND DIRECTORY NAME (PATH).

      CHARACTER*(*) FSPEC, FNAME

C     FIND END OF SPECIFICATION.
      LFS = LEN(FSPEC)
      DO 10 I = 1, LFS
        IF (FSPEC(I:I).EQ.' ') GOTO 20
   10 CONTINUE
   20 IES = I - 1
      IEN = IES

C     FIND START OF NAME.
      DO 30 I = IES, 1, -1
        IF (FSPEC(I:I).EQ.':' .OR. FSPEC(I:I).EQ.'/') GOTO 40
   30 CONTINUE
   40 IBN = I + 1

C     STORE NAME.
   80 IF (FSPEC(IEN:IEN).EQ.'.') IEN = IEN - 1
      FNAME = ' '
      IF (IBN.LE.IEN) FNAME = FSPEC(IBN:IEN)

      RETURN
      END
      SUBROUTINE GETTIME (TIM, DAT)                                         XSSS

C* REVISED 19/8/87.
C* GETS THE TIME AND DATE.

      CHARACTER*10 TIM,DAT

      character*25 test

      test = ctime(time8())
      tim = test(12:19)
      dat = test(9:10) // '-' // test(5:7) // '-' // test(23:24)
!      CALL TIME (TIM)
!      TIM(9:10) = ' '
!      CALL DATE (DAT)
!      DAT(10:10) = ' '

      RETURN
      END
      FUNCTION IIBIT (N, IA, NBITS)                                         XSSS
 
C  REVISED 6-DEC-88.
C  EXTRACTS A BIT FROM AN ARRAY, BITS BEING NUMBERED LEFT TO RIGHT, 
C    STARTING AT 1.
 
C  N RECEIVES THE BIT NUMBER.
C  IA RECEIVES THE ARRAY.
 
      DIMENSION IA(1000)
      LOGICAL*4 BTEST
 
      IW = (N-1)/NBITS
      I = N - IW*NBITS
      IIBIT = 0
      IF (BTEST(IA(IW+1),I-1))  IIBIT = 1
 
      RETURN
      END
      SUBROUTINE INITF (LUNE, LUNI, LUNTI, LUNTO, LUNUSE, NUN)              XSSS

C* REVISED 19/8/87.
C* INITIALIZES SYSTEM-DEPENDENT INPUT/OUTPUT.

C  LUNE RETURNS THE ERROR LOGICAL UNIT.
C  LUNI RETURNS THE INITIAL INPUT LOGICAL UNIT.
C  LUNTI RETURNS THE TERMINAL INPUT LOGICAL UNIT.
C  LUNTO RETURNS THE TERMINAL OUTPUT LOGICAL UNIT.
C  LUNUSE RETURNS FLAGS INDICATING UNAVAILABLE LOGICAL UNITS (SEE
C    BELOW).
C  NUN RECEIVES THE DIMENSION OF LUNUSE.

C  THIS SUBR. MUST:
C  (1) SET LUNUSE(LUN) TO 0 FOR ANY LOGICAL UNITS WHOSE USE
C      IS RESTRICTED BY THE OPERATING SYSTEM.
C  (2) IF TERMINAL INPUT/OUTPUT IS REQUIRED, SET LUNTI AND LUNTO
C      TO THE REQUIRED VALUES, AND OPEN THESE UNITS IF NECESSARY.
C  (3) OPEN A UNIT FOR INITIAL OUTPUT OF ERROR MESSAGES, AND SET
C      LUNE TO THE NUMBER OF THIS UNIT.
C  (4) OPEN A UNIT FOR INITIAL INPUT OF DIRECTIVES, AND SET
C      LUNI TO THE NUMBER OF THIS UNIT.

      DIMENSION LUNUSE(NUN)
      CHARACTER FNAME*60,MESS*20
      LOGICAL*4 E

C-    SET LUNUSE(LUN) TO 0 FOR ANY UNUSABLE LOGICAL UNITS.
      CONTINUE
      LUNUSE(5) = 0
      LUNUSE(6) = 0

C-    OPEN TERMINAL INPUT AND OUTPUT UNITS.
C     NOTE. ACTUAL I/O IS DONE ON UNIT 0. THE VARIABLES ARE SET TO 1 TO
C     AVOID ARRAY-BOUNDS ERRORS (MS-FORTRAN DOES NOT ALLOW SUBSCRIPT 0).
      LUNTI = 5
      LUNTO = 6

C-    SET ERROR UNIT.
      LUNE = LUNTO

C-    OPEN MAIN DIRECTIVES FILE.
      LUNI = 2

C     GET THE COMMAND LINE.
      IF (IARGC().GT.0) THEN
        CALL GETARG(1, FNAME) 

C     USE DEFAULT FILE IF IT EXISTS, ELSE USE NONE.
      ELSE
        FNAME = 'dist'
        INQUIRE (FILE=FNAME, EXIST=E)
        IF (.NOT.E) GOTO 100
      ENDIF

C     CHECK FOR EXISTENCE OF THE FILE, AND OPEN IT.
      INQUIRE (FILE=FNAME, EXIST=E)
      IF (.NOT.E) GOTO 210
      OPEN (UNIT=LUNI, FILE=FNAME, STATUS='OLD', ERR=220)
C-
  100 RETURN

C-    FATAL ERRORS.
  210 MESS = ' DOES NOT EXIST.'
      GOTO 290

  220 MESS = ' IS NOT ACCESSIBLE.'

  290 DO 292 I = 60, 2, -1
       IF (FNAME(I:I).NE.' ') GOTO 294
  292 CONTINUE

  294 WRITE (0, *) '****** FILE ', FNAME(1:I), MESS

  300 STOP ' '
      END
      SUBROUTINE RREC (IBUF, LBUF, LREC, LUN)                               XSSS

C* REVISED 19/8/87.
C* READS AN INPUT RECORD.

C  IBUF RETURNS THE RECORD.
C  LBUF RECEIVES THE AVAILABLE LENGTH OF IBUF. (ACTUAL LENGTH MUST BE
C    AT LEAST LBUF+1.)
C  LREC RETURNS THE RECORD LENGTH. IF EOF, LREC IS SET TO -1.
C  LUN RECEIVES THE LOGICAL UNIT.

      CHARACTER*(*) IBUF
      CHARACTER*180 BUF

      PARAMETER (ICR=13)
	  
      READ (LUN, 10, END=20) IBUF
   10 FORMAT (A)
      LREC = LEN_TRIM(IBUF)
	  IF (LREC.LE.0) GO TO 100

      DO 40 I = 1, LREC
        IF (ICHAR(IBUF(I:I)).EQ.ICR)  IBUF(I:I) = ' '
   40 CONTINUE
      GOTO 100 
		
   20 LREC = -1

  100 RETURN
      END
 	  
      SUBROUTINE UOPEN (LUN, LUNTYP, FSPEC, LRECDA, LRECSC, IERR)           XSSS

C* REVISED 22/9/87.
C* OPENS A FILE.

C  LUN RECEIVES THE LOGICAL UNIT NUMBER.
C  LUNTYP RECEIVES THE TYPE OF LUN.
C  FSPEC RECEIVES THE FILE SPECIFICATION.
C  LRECDA RECEIVES THE LENGTH OF DIRECT-ACCESS DATA RECORDS, IN WORDS.
C  LRECSC RECEIVES THE LENGTH OF DIRECT-ACCESS SCRATCH RECORDS,
C    IN WORDS.
C  IERR RETURNS 1 IF ERROR, 0 OTHERWISE.

      CHARACTER*(*) FSPEC

      IERR = 0

      IF (LUNTYP.EQ.1) THEN
        OPEN (UNIT=LUN, FILE=FSPEC, ERR=100, STATUS='OLD')
      ELSEIF (LUNTYP.EQ.2) THEN
        OPEN (UNIT=LUN, FILE=FSPEC, ERR=100, STATUS='OLD',
     *  FORM='UNFORMATTED', ACCESS='DIRECT', RECL=LRECDA*4)
      ELSEIF (LUNTYP.EQ.3 .OR. LUNTYP.EQ.7 .OR.
     *        LUNTYP.EQ.4 .OR. LUNTYP.EQ.5) THEN
        OPEN (UNIT=LUN, FILE=FSPEC, ERR=100,
     *  STATUS='UNKNOWN')
      ELSEIF (LUNTYP.EQ.6) THEN
        OPEN (UNIT=LUN, FILE=FSPEC, ERR=100, STATUS='UNKNOWN',
     *  FORM='UNFORMATTED', ACCESS='DIRECT', RECL=LRECSC*4)
      ENDIF

      RETURN

  100 IERR = 1

      RETURN
      END
C      CHARACTER*1 FUNCTION UPCASE (CHR)                                     XSSS
C
C* REVISED 14/2/92
C* CONVERTS SINGLE CHARACTER TO UPPERCASE
C
C      CHARACTER*1 CHR
C      IF (CHR.GE.'a'.AND.ICHR.LE.'z') THEN
C        UPCASE = CHAR (ICHAR(CHR) - 32)
C      ELSE
C        UPCASE = CHR
C      ENDIF
C
C      RETURN
C      END
      SUBROUTINE WREC (STR, LUN)                                            XSSS

C* REVISED 19/8/87.
C* WRITES A STRING ON A LOGICAL UNIT.

C  STR RECEIVES THE STRING.
C  LUN RECEIVES THE LOGICAL UNIT.

      COMMON /LUTXXX/ LUNTI,LUNTO

      CHARACTER*(*) STR

      WRITE (LUN, 20) STR
   20 FORMAT (A)

      RETURN
      END
